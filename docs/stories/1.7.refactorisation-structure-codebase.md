# User Story 1.7 : Refactorisation de la Structure du Codebase

## **Informations G√©n√©rales**

| Champ | Valeur |
|-------|--------|
| **ID** | US-1.7 |
| **Titre** | Refactorisation de la Structure du Codebase |
| **Type** | Refactoring Technique |
| **Priorit√©** | Moyenne |
| **Story Points** | 8 |
| **Sprint** | Sprint 3 |
| **Assign√©** | √âquipe Frontend |

## **Contexte et Probl√©matique**

La structure actuelle du codebase dans `apps/web/src/` pr√©sente plusieurs incoh√©rences qui impactent la maintenabilit√© et l'√©volutivit√© du projet :

### **Probl√®mes Identifi√©s**
1. **API Routes non standardis√©es** : Structure incoh√©rente entre `github/repos` et `workspaces/[id]/context`
2. **Composants mal organis√©s** : M√©lange de composants universels et sp√©cifiques au m√™me niveau
3. **Types dispers√©s** : Types √©parpill√©s dans `lib/types/` au lieu d'√™tre co-localis√©s
4. **Dossiers temporaires** : Pr√©sence de `test-docs/` non document√©
5. **Manque de conventions** : Absence de structure claire pour les utilitaires et constantes

### **Impact sur les Objectifs Produit**
- **Maintenabilit√© d√©grad√©e** : Difficult√© √† localiser et modifier le code
- **Onboarding ralenti** : Nouveaux d√©veloppeurs perdent du temps √† comprendre la structure
- **Risque d'erreurs** : Incoh√©rences dans l'organisation augmentent les bugs
- **V√©locit√© r√©duite** : Temps de d√©veloppement allong√© pour les nouvelles fonctionnalit√©s

## **User Story**

**En tant que** d√©veloppeur frontend  
**Je veux** une structure de codebase coh√©rente et bien organis√©e  
**Afin de** am√©liorer la maintenabilit√©, faciliter l'onboarding et acc√©l√©rer le d√©veloppement

## **Crit√®res d'Acceptation**

### **AC1 : Restructuration des API Routes**
- [ ] **Structure standardis√©e** : Toutes les API routes suivent le pattern `/api/{resource}/[id]/{action}`
- [ ] **Organisation logique** : Routes group√©es par domaine fonctionnel
- [ ] **Nomenclature coh√©rente** : Noms de fichiers et endpoints standardis√©s
- [ ] **Documentation** : Chaque route a une documentation claire de son usage

### **AC2 : R√©organisation des Composants**
- [ ] **S√©paration claire** : Composants universels vs sp√©cifiques bien s√©par√©s
- [ ] **Groupement th√©matique** : Composants organis√©s par domaine (layout, ui, documentation, workspace)
- [ ] **R√©utilisabilit√©** : Structure facilitant la r√©utilisation des composants
- **Structure cible :**
  ```
  components/
  ‚îú‚îÄ‚îÄ layout/           # Composants de mise en page
  ‚îú‚îÄ‚îÄ ui/              # Composants d'interface universels
  ‚îú‚îÄ‚îÄ documentation/   # Composants sp√©cifiques √† la documentation
  ‚îî‚îÄ‚îÄ workspace/       # Composants sp√©cifiques aux workspaces
  ```

### **AC3 : Restructuration des Types**
- [ ] **Co-localisation** : Types organis√©s par domaine d'usage
- [ ] **S√©paration API/UI** : Types d'API s√©par√©s des types de composants
- [ ] **Nomenclature claire** : Conventions de nommage standardis√©es
- **Structure cible :**
  ```
  types/
  ‚îú‚îÄ‚îÄ api/             # Types pour les API
  ‚îú‚îÄ‚îÄ components/      # Types pour les composants
  ‚îú‚îÄ‚îÄ auth.ts          # Types d'authentification
  ‚îî‚îÄ‚îÄ common.ts        # Types partag√©s
  ```

### **AC4 : Ajout de Dossiers Manquants**
- [ ] **Dossier constants** : Centralisation des constantes de l'application
- [ ] **Dossier utils** : Utilitaires r√©utilisables organis√©s par domaine
- [ ] **Hooks organis√©s** : Hooks personnalis√©s bien structur√©s

### **AC5 : Nettoyage et Documentation**
- [ ] **Suppression test-docs** : Dossier temporaire supprim√© ou document√©
- [ ] **Mise √† jour architecture.md** : Documentation technique √† jour
- [ ] **Guide de conventions** : Document de bonnes pratiques cr√©√©

## **D√©tails Techniques**

### **Phase 1 : Nettoyage Imm√©diat**

#### **1.1 Suppression du Dossier test-docs**
```bash
# V√©rifier le contenu et l'usage
ls -la apps/web/src/app/api/test-docs/
# Supprimer si non utilis√©
rm -rf apps/web/src/app/api/test-docs/
```

#### **1.2 Restructuration des API Routes**
**Structure actuelle :**
```
api/
‚îú‚îÄ‚îÄ github/repos/
‚îú‚îÄ‚îÄ workspaces/[id]/
‚îÇ   ‚îú‚îÄ‚îÄ analyze/
‚îÇ   ‚îú‚îÄ‚îÄ context/
‚îÇ   ‚îú‚îÄ‚îÄ documentation/
‚îÇ   ‚îî‚îÄ‚îÄ issues/
‚îî‚îÄ‚îÄ test-docs/  # √Ä supprimer
```

**Structure cible :**
```
api/
‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îú‚îÄ‚îÄ callback/
‚îÇ   ‚îî‚îÄ‚îÄ signout/
‚îú‚îÄ‚îÄ github/
‚îÇ   ‚îî‚îÄ‚îÄ repos/
‚îú‚îÄ‚îÄ workspaces/
‚îÇ   ‚îú‚îÄ‚îÄ route.ts                    # GET /api/workspaces
‚îÇ   ‚îî‚îÄ‚îÄ [id]/
‚îÇ       ‚îú‚îÄ‚îÄ route.ts               # GET/PUT/DELETE /api/workspaces/[id]
‚îÇ       ‚îú‚îÄ‚îÄ analyze/
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts           # POST /api/workspaces/[id]/analyze
‚îÇ       ‚îú‚îÄ‚îÄ context/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route.ts           # GET /api/workspaces/[id]/context
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ tree/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts       # GET /api/workspaces/[id]/context/tree
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ file-content/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ route.ts       # GET /api/workspaces/[id]/context/file-content
‚îÇ       ‚îú‚îÄ‚îÄ documentation/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ route.ts           # GET /api/workspaces/[id]/documentation
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ tree/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts       # GET /api/workspaces/[id]/documentation/tree
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ files/
‚îÇ       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts       # CRUD /api/workspaces/[id]/documentation/files
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ folders/
‚îÇ       ‚îÇ       ‚îî‚îÄ‚îÄ route.ts       # CRUD /api/workspaces/[id]/documentation/folders
‚îÇ       ‚îî‚îÄ‚îÄ issues/
‚îÇ           ‚îî‚îÄ‚îÄ route.ts           # GET/POST /api/workspaces/[id]/issues
‚îî‚îÄ‚îÄ health/
    ‚îî‚îÄ‚îÄ route.ts                   # GET /api/health
```

### **Phase 2 : Restructuration des Composants**

#### **2.1 Cr√©ation de la Nouvelle Structure**
```bash
# Cr√©er les nouveaux dossiers
mkdir -p apps/web/src/components/{layout,ui,documentation,workspace}
mkdir -p apps/web/src/components/ui/universal
```

#### **2.2 Migration des Composants**
**D√©placements √† effectuer :**

```typescript
// D√©placer les composants de layout
mv apps/web/src/components/ThreePanelsLayout.tsx apps/web/src/components/layout/
mv apps/web/src/components/ErrorScreen.tsx apps/web/src/components/ui/
mv apps/web/src/components/LoadingScreen.tsx apps/web/src/components/ui/

// D√©placer les composants universels
mv apps/web/src/components/universal/* apps/web/src/components/ui/universal/

// D√©placer les composants sp√©cifiques
mv apps/web/src/components/documentation/* apps/web/src/components/documentation/
mv apps/web/src/components/RichTextEditor.tsx apps/web/src/components/documentation/

// Cr√©er de nouveaux composants workspace
touch apps/web/src/components/workspace/WorkspaceSelector.tsx
touch apps/web/src/components/workspace/WorkspaceHeader.tsx
```

#### **2.3 Mise √† Jour des Imports**
**Exemple de refactoring des imports :**

```typescript
// Avant
import { ThreePanelsLayout } from '@/components/ThreePanelsLayout'
import { UniversalChatPanel } from '@/components/universal/UniversalChatPanel'

// Apr√®s
import { ThreePanelsLayout } from '@/components/layout/ThreePanelsLayout'
import { UniversalChatPanel } from '@/components/ui/universal/UniversalChatPanel'
```

### **Phase 3 : Restructuration des Types**

#### **3.1 Cr√©ation de la Nouvelle Structure**
```bash
# Cr√©er les nouveaux dossiers de types
mkdir -p apps/web/src/types/{api,components}
```

#### **3.2 Migration des Types**
```typescript
// D√©placer et r√©organiser les types
mv apps/web/src/lib/types/context.ts apps/web/src/types/api/workspace.ts
mv apps/web/src/lib/types/documentation.ts apps/web/src/types/api/documentation.ts
mv apps/web/src/lib/types/universal-components.ts apps/web/src/types/components/universal.ts

// Cr√©er de nouveaux fichiers de types
touch apps/web/src/types/api/github.ts
touch apps/web/src/types/components/ui.ts
touch apps/web/src/types/auth.ts
```

#### **3.3 Exemple de Structure des Types**
```typescript
// types/api/workspace.ts
export interface Workspace {
  id: string;
  name: string;
  url: string;
  ownerId: string;
  knowledgeBaseId?: string;
}

// types/components/universal.ts
export interface ThreePanelsLayoutProps {
  leftPanel: React.ReactNode;
  centerPanel: React.ReactNode;
  rightPanel: React.ReactNode;
  layoutConfig?: LayoutConfig;
}
```

### **Phase 4 : Ajout de Dossiers Manquants**

#### **4.1 Dossier Constants**
```bash
mkdir -p apps/web/src/constants
touch apps/web/src/constants/api.ts
touch apps/web/src/constants/routes.ts
touch apps/web/src/constants/ui.ts
```

**Exemple de contenu :**
```typescript
// constants/api.ts
export const API_ENDPOINTS = {
  WORKSPACES: '/api/workspaces',
  GITHUB_REPOS: '/api/github/repos',
  AUTH_CALLBACK: '/api/auth/callback',
} as const;

// constants/routes.ts
export const ROUTES = {
  HOME: '/',
  LOGIN: '/login',
  WORKSPACES: '/workspaces',
  WORKSPACE_CONTEXT: (id: string) => `/workspaces/${id}/context`,
  WORKSPACE_DOCUMENTATION: (id: string) => `/workspaces/${id}/documentation`,
  WORKSPACE_ISSUES: (id: string) => `/workspaces/${id}/issues`,
} as const;
```

#### **4.2 Dossier Utils**
```bash
mkdir -p apps/web/src/utils
touch apps/web/src/utils/api.ts
touch apps/web/src/utils/auth.ts
touch apps/web/src/utils/formatting.ts
```

**Exemple de contenu :**
```typescript
// utils/api.ts
export const apiClient = {
  async get<T>(endpoint: string): Promise<T> {
    const response = await fetch(endpoint);
    if (!response.ok) throw new Error(`API Error: ${response.status}`);
    return response.json();
  },
  
  async post<T>(endpoint: string, data: any): Promise<T> {
    const response = await fetch(endpoint, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(data),
    });
    if (!response.ok) throw new Error(`API Error: ${response.status}`);
    return response.json();
  },
};

// utils/formatting.ts
export const formatFileSize = (bytes: number): string => {
  if (bytes === 0) return '0 Bytes';
  const k = 1024;
  const sizes = ['Bytes', 'KB', 'MB', 'GB'];
  const i = Math.floor(Math.log(bytes) / Math.log(k));
  return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
};
```

### **Phase 5 : Documentation et Tests**

#### **5.1 Mise √† Jour de l'Architecture**
```markdown
# Mettre √† jour doc/architecture.md
- Ajouter la section "Structure du Codebase"
- Documenter les conventions de nommage
- Expliquer l'organisation des dossiers
```

#### **5.2 Cr√©ation du Guide de Conventions**
```markdown
# docs/development/code-conventions.md
## Structure des Dossiers
## Conventions de Nommage
## Patterns d'API
## Organisation des Composants
## Gestion des Types
```

#### **5.3 Mise √† Jour des Tests**
```bash
# Mettre √† jour les imports dans les tests
find apps/web/src -name "*.test.ts" -exec sed -i '' 's/@\/components\/ThreePanelsLayout/@\/components\/layout\/ThreePanelsLayout/g' {} \;
```

## **T√¢ches Techniques D√©taill√©es**

### **T√¢che T1.1 : Pr√©paration et Sauvegarde**
**Dur√©e estim√©e :** 4 heures  
**Assign√© :** Lead Developer  
**Priorit√© :** Critique

#### **Sous-t√¢ches :**
- [x] **T1.1.1** Cr√©er la branche `refactor/structure-cleanup`
  ```bash
  git checkout -b refactor/structure-cleanup
  git push -u origin refactor/structure-cleanup
  ```
- [x] **T1.1.2** Cr√©er un snapshot de l'√©tat actuel
  ```bash
  # Sauvegarder la structure actuelle
  find apps/web/src -type f -name "*.ts" -o -name "*.tsx" | sort > structure-before.txt
  # Cr√©er un tag de sauvegarde
  git tag backup-before-refactor-$(date +%Y%m%d)
  ```
- [x] **T1.1.3** Cr√©er un script de rollback
  ```bash
  # rollback.sh
  #!/bin/bash
  echo "Rollback to previous state..."
  git reset --hard backup-before-refactor-$(date +%Y%m%d)
  git clean -fd
  ```
- [x] **T1.1.4** Identifier tous les imports √† migrer
  ```bash
  # Script pour lister tous les imports
  grep -r "import.*@/components" apps/web/src/ | cut -d: -f1 | sort | uniq > imports-to-update.txt
  grep -r "import.*@/lib/types" apps/web/src/ | cut -d: -f1 | sort | uniq >> imports-to-update.txt
  ```

### **T√¢che T1.2 : Nettoyage du Dossier test-docs**
**Dur√©e estim√©e :** 2 heures  
**Assign√© :** Junior Developer  
**Priorit√© :** Haute

#### **Sous-t√¢ches :**
- [x] **T1.2.1** Analyser le contenu du dossier test-docs
  ```bash
  ls -la apps/web/src/app/api/test-docs/
  find apps/web/src/app/api/test-docs/ -name "*.ts" -exec cat {} \;
  ```
- [x] **T1.2.2** V√©rifier les r√©f√©rences dans le code
  ```bash
  grep -r "test-docs" apps/web/src/
  grep -r "/api/test-docs" apps/web/src/
  ```
- [x] **T1.2.3** Supprimer le dossier si non utilis√©
  ```bash
  rm -rf apps/web/src/app/api/test-docs/
  ```
- [x] **T1.2.4** Mettre √† jour les tests si n√©cessaire
  ```bash
  # V√©rifier les tests qui r√©f√©rencent test-docs
  find apps/web/src -name "*.test.ts" -exec grep -l "test-docs" {} \;
  ```

### **T√¢che T1.3 : Restructuration des API Routes**
**Dur√©e estim√©e :** 8 heures  
**Assign√© :** Backend Developer  
**Priorit√© :** Haute

#### **Sous-t√¢ches :**
- [ ] **T1.3.1** Cr√©er la nouvelle structure de dossiers
  ```bash
  mkdir -p apps/web/src/app/api/auth
  mkdir -p apps/web/src/app/api/health
  mkdir -p apps/web/src/app/api/workspaces/[id]/analyze
  mkdir -p apps/web/src/app/api/workspaces/[id]/context/{tree,file-content}
  mkdir -p apps/web/src/app/api/workspaces/[id]/documentation/{tree,files,folders}
  mkdir -p apps/web/src/app/api/workspaces/[id]/issues
  ```
- [ ] **T1.3.2** Migrer les routes existantes
  ```bash
  # D√©placer les routes workspaces
  mv apps/web/src/app/api/workspaces/route.ts apps/web/src/app/api/workspaces/route.ts.backup
  # Cr√©er la nouvelle route principale
  touch apps/web/src/app/api/workspaces/route.ts
  ```
- [ ] **T1.3.3** Cr√©er les nouvelles routes manquantes
  ```typescript
  // apps/web/src/app/api/workspaces/route.ts
  import { NextRequest, NextResponse } from 'next/server';
  
  export async function GET(request: NextRequest) {
    // Logique pour lister tous les workspaces
    return NextResponse.json({ workspaces: [] });
  }
  
  export async function POST(request: NextRequest) {
    // Logique pour cr√©er un nouveau workspace
    return NextResponse.json({ message: 'Workspace created' });
  }
  ```
- [ ] **T1.3.4** Cr√©er la route health
  ```typescript
  // apps/web/src/app/api/health/route.ts
  import { NextResponse } from 'next/server';
  
  export async function GET() {
    return NextResponse.json({ 
      status: 'healthy', 
      timestamp: new Date().toISOString() 
    });
  }
  ```

### **T√¢che T1.4 : Restructuration des Composants**
**Dur√©e estim√©e :** 6 heures  
**Assign√© :** Frontend Developer  
**Priorit√© :** Haute

#### **Sous-t√¢ches :**
- [x] **T1.4.1** Cr√©er la nouvelle structure de composants
  ```bash
  mkdir -p apps/web/src/components/{layout,ui,documentation,workspace}
  mkdir -p apps/web/src/components/ui/universal
  ```
- [x] **T1.4.2** Migrer les composants de layout
  ```bash
  mv apps/web/src/components/ThreePanelsLayout.tsx apps/web/src/components/layout/
  mv apps/web/src/components/ErrorScreen.tsx apps/web/src/components/ui/
  mv apps/web/src/components/LoadingScreen.tsx apps/web/src/components/ui/
  ```
- [x] **T1.4.3** Migrer les composants universels
  ```bash
  mv apps/web/src/components/universal/* apps/web/src/components/ui/universal/
  rmdir apps/web/src/components/universal
  ```
- [x] **T1.4.4** Cr√©er les nouveaux composants workspace
  ```typescript
  // apps/web/src/components/workspace/WorkspaceSelector.tsx
  import React from 'react';
  
  interface WorkspaceSelectorProps {
    workspaces: Array<{ id: string; name: string }>;
    selectedWorkspaceId?: string;
    onWorkspaceChange: (workspaceId: string) => void;
  }
  
  export function WorkspaceSelector({ 
    workspaces, 
    selectedWorkspaceId, 
    onWorkspaceChange 
  }: WorkspaceSelectorProps) {
    return (
      <select 
        value={selectedWorkspaceId} 
        onChange={(e) => onWorkspaceChange(e.target.value)}
        className="px-3 py-2 border rounded-md"
      >
        {workspaces.map(workspace => (
          <option key={workspace.id} value={workspace.id}>
            {workspace.name}
          </option>
        ))}
      </select>
    );
  }
  ```

### **T√¢che T1.5 : Restructuration des Types**
**Dur√©e estim√©e :** 4 heures  
**Assign√© :** Frontend Developer  
**Priorit√© :** Moyenne

#### **Sous-t√¢ches :**
- [x] **T1.5.1** Cr√©er la nouvelle structure de types
  ```bash
  mkdir -p apps/web/src/types/{api,components}
  ```
- [x] **T1.5.2** Migrer les types existants
  ```bash
  mv apps/web/src/lib/types/context.ts apps/web/src/types/api/workspace.ts
  mv apps/web/src/lib/types/documentation.ts apps/web/src/types/api/documentation.ts
  mv apps/web/src/lib/types/universal-components.ts apps/web/src/types/components/universal.ts
  ```
- [x] **T1.5.3** Cr√©er les nouveaux fichiers de types
  ```typescript
  // apps/web/src/types/api/github.ts
  export interface GitHubRepo {
    id: number;
    name: string;
    full_name: string;
    private: boolean;
    html_url: string;
    description?: string;
  }
  
  export interface GitHubUser {
    id: number;
    login: string;
    avatar_url: string;
    name?: string;
  }
  ```
- [x] **T1.5.4** Cr√©er le fichier de types communs
  ```typescript
  // apps/web/src/types/common.ts
  export interface ApiResponse<T = any> {
    data?: T;
    error?: string;
    success: boolean;
  }
  
  export interface PaginationParams {
    page?: number;
    limit?: number;
    offset?: number;
  }
  ```

### **T√¢che T1.6 : Cr√©ation des Dossiers Constants et Utils**
**Dur√©e estim√©e :** 3 heures  
**Assign√© :** Junior Developer  
**Priorit√© :** Moyenne

#### **Sous-t√¢ches :**
- [x] **T1.6.1** Cr√©er la structure des constants
  ```bash
  mkdir -p apps/web/src/constants
  touch apps/web/src/constants/{api,routes,ui}.ts
  ```
- [x] **T1.6.2** Impl√©menter les constants API
  ```typescript
  // apps/web/src/constants/api.ts
  export const API_ENDPOINTS = {
    WORKSPACES: '/api/workspaces',
    GITHUB_REPOS: '/api/github/repos',
    AUTH_CALLBACK: '/api/auth/callback',
    AUTH_SIGNOUT: '/api/auth/signout',
    HEALTH: '/api/health',
  } as const;
  
  export const API_METHODS = {
    GET: 'GET',
    POST: 'POST',
    PUT: 'PUT',
    DELETE: 'DELETE',
  } as const;
  ```
- [x] **T1.6.3** Impl√©menter les constants de routes
  ```typescript
  // apps/web/src/constants/routes.ts
  export const ROUTES = {
    HOME: '/',
    LOGIN: '/login',
    WORKSPACES: '/workspaces',
    WORKSPACE_CONTEXT: (id: string) => `/workspaces/${id}/context`,
    WORKSPACE_DOCUMENTATION: (id: string) => `/workspaces/${id}/documentation`,
    WORKSPACE_ISSUES: (id: string) => `/workspaces/${id}/issues`,
  } as const;
  ```
- [x] **T1.6.4** Cr√©er la structure des utils
  ```bash
  mkdir -p apps/web/src/utils
  touch apps/web/src/utils/{api,auth,formatting}.ts
  ```

### **T√¢che T1.7 : Mise √† Jour des Imports**
**Dur√©e estim√©e :** 6 heures  
**Assign√© :** Frontend Developer  
**Priorit√© :** Critique

#### **Sous-t√¢ches :**
- [x] **T1.7.1** Cr√©er un script de migration des imports
  ```bash
  #!/bin/bash
  # migrate-imports.sh
  
  echo "üöÄ D√©but de la migration des imports..."
  
  # Migration des imports de composants
  find apps/web/src -name "*.ts" -o -name "*.tsx" | xargs sed -i '' \
    -e 's|@/components/ThreePanelsLayout|@/components/layout/ThreePanelsLayout|g' \
    -e 's|@/components/ErrorScreen|@/components/ui/ErrorScreen|g' \
    -e 's|@/components/LoadingScreen|@/components/ui/LoadingScreen|g' \
    -e 's|@/components/universal/|@/components/ui/universal/|g'
  
  # Migration des imports de types
  find apps/web/src -name "*.ts" -o -name "*.tsx" | xargs sed -i '' \
    -e 's|@/lib/types/context|@/types/api/workspace|g' \
    -e 's|@/lib/types/documentation|@/types/api/documentation|g' \
    -e 's|@/lib/types/universal-components|@/types/components/universal|g'
  
  echo "‚úÖ Migration des imports termin√©e!"
  ```
- [x] **T1.7.2** Ex√©cuter le script de migration
  ```bash
  chmod +x migrate-imports.sh
  ./migrate-imports.sh
  ```
- [x] **T1.7.3** V√©rifier les imports manquants
  ```bash
  # V√©rifier les imports cass√©s
  npm run build 2>&1 | grep "Cannot find module"
  ```
- [x] **T1.7.4** Corriger manuellement les imports probl√©matiques
  ```typescript
  // Exemple de correction manuelle
  // Avant
  import { Workspace } from '@/lib/types/context';
  
  // Apr√®s
  import { Workspace } from '@/types/api/workspace';
  ```
- [x] **T1.7.5** Migrer les appels fetch vers le client API
  ```typescript
  // Avant
  const response = await fetch('/api/workspaces');
  
  // Apr√®s
  const response = await apiClient.get(API_ENDPOINTS.WORKSPACES);
  ```
- [x] **T1.7.6** Ajouter les utilitaires manquants pour les API routes
  ```typescript
  // Ajout de createErrorResponse et handleApiError
  export const createErrorResponse = (message: string, code: string, status: number) => { ... };
  export const handleApiError = (error: unknown) => { ... };
  ```

### **T√¢che T1.8 : Tests et Validation**
**Dur√©e estim√©e :** 8 heures  
**Assign√© :** QA Developer  
**Priorit√© :** Critique

#### **Sous-t√¢ches :**
- [ ] **T1.8.1** Mettre √† jour les imports dans les tests
  ```bash
  # Mettre √† jour les imports dans les fichiers de test
  find apps/web/src -name "*.test.ts" -o -name "*.test.tsx" | xargs sed -i '' \
    -e 's|@/components/ThreePanelsLayout|@/components/layout/ThreePanelsLayout|g'
  ```
- [ ] **T1.8.2** Ex√©cuter la suite de tests unitaires
  ```bash
  npm run test:unit
  npm run test:integration
  ```
- [ ] **T1.8.3** Ex√©cuter les tests E2E
  ```bash
  npm run test:e2e
  ```
- [ ] **T1.8.4** Valider le build de production
  ```bash
  npm run build
  npm run start
  ```
- [ ] **T1.8.5** Tester les parcours utilisateurs critiques
  - [ ] Connexion OAuth GitHub
  - [ ] Navigation dans les workspaces
  - [ ] Acc√®s aux pages Context, Documentation, Issues
  - [ ] Fonctionnalit√©s de chat IA

### **T√¢che T1.9 : Documentation**
**Dur√©e estim√©e :** 4 heures  
**Assign√© :** Technical Writer  
**Priorit√© :** Moyenne

#### **Sous-t√¢ches :**
- [ ] **T1.9.1** Mettre √† jour l'architecture.md
  ```markdown
  # Ajouter √† doc/architecture.md
  
  ## Structure du Codebase
  
  ### Organisation des Dossiers
  ```
  apps/web/src/
  ‚îú‚îÄ‚îÄ app/                    # Next.js App Router
  ‚îÇ   ‚îú‚îÄ‚îÄ (pages)/           # Pages publiques
  ‚îÇ   ‚îú‚îÄ‚îÄ api/               # API Routes
  ‚îÇ   ‚îî‚îÄ‚îÄ auth/              # Routes d'authentification
  ‚îú‚îÄ‚îÄ components/            # Composants React
  ‚îÇ   ‚îú‚îÄ‚îÄ layout/            # Composants de mise en page
  ‚îÇ   ‚îú‚îÄ‚îÄ ui/                # Composants d'interface universels
  ‚îÇ   ‚îú‚îÄ‚îÄ documentation/     # Composants sp√©cifiques √† la documentation
  ‚îÇ   ‚îî‚îÄ‚îÄ workspace/         # Composants sp√©cifiques aux workspaces
  ‚îú‚îÄ‚îÄ types/                 # Types TypeScript
  ‚îÇ   ‚îú‚îÄ‚îÄ api/               # Types pour les API
  ‚îÇ   ‚îú‚îÄ‚îÄ components/        # Types pour les composants
  ‚îÇ   ‚îú‚îÄ‚îÄ auth.ts            # Types d'authentification
  ‚îÇ   ‚îî‚îÄ‚îÄ common.ts          # Types partag√©s
  ‚îú‚îÄ‚îÄ constants/             # Constantes de l'application
  ‚îú‚îÄ‚îÄ utils/                 # Utilitaires r√©utilisables
  ‚îî‚îÄ‚îÄ hooks/                 # Hooks personnalis√©s
  ```
  ```
- [ ] **T1.9.2** Cr√©er le guide de conventions
  ```markdown
  # docs/development/code-conventions.md
  
  ## Conventions de Nommage
  
  ### Fichiers et Dossiers
  - **Composants** : PascalCase (ex: `ThreePanelsLayout.tsx`)
  - **Hooks** : camelCase avec pr√©fixe `use` (ex: `useAuth.ts`)
  - **Types** : PascalCase (ex: `Workspace.ts`)
  - **Constants** : UPPER_SNAKE_CASE (ex: `API_ENDPOINTS`)
  
  ### API Routes
  - **Structure** : `/api/{resource}/[id]/{action}`
  - **M√©thodes** : GET, POST, PUT, DELETE
  - **R√©ponses** : Format JSON standardis√©
  
  ### Imports
  - **Ordre** : React, biblioth√®ques externes, composants internes, types, utils
  - **Alias** : Utiliser `@/` pour les imports relatifs √† `src/`
  ```
- [ ] **T1.9.3** Documenter les changements dans le changelog
  ```markdown
  # CHANGELOG.md
  
  ## [Unreleased] - 2025-01-26
  
  ### Changed
  - Refactorisation compl√®te de la structure du codebase
  - R√©organisation des composants par domaine
  - Restructuration des types TypeScript
  - Standardisation des API routes
  
  ### Added
  - Nouveaux dossiers constants et utils
  - Guide de conventions de d√©veloppement
  - Structure de types organis√©e par domaine
  
  ### Removed
  - Dossier test-docs temporaire
  - Types dispers√©s dans lib/types/
  ```

### **T√¢che T1.10 : Validation Finale et Merge**
**Dur√©e estim√©e :** 2 heures  
**Assign√© :** Lead Developer  
**Priorit√© :** Critique

#### **Sous-t√¢ches :**
- [ ] **T1.10.1** Code review compl√®te
  ```bash
  # Cr√©er une pull request
  git add .
  git commit -m "refactor: restructure codebase organization"
  git push origin refactor/structure-cleanup
  ```
- [ ] **T1.10.2** Validation par l'√©quipe
  - [ ] Review du code par au moins 2 d√©veloppeurs
  - [ ] Validation des tests par QA
  - [ ] Approbation finale par PO
- [ ] **T1.10.3** Merge en main
  ```bash
  git checkout main
  git merge refactor/structure-cleanup
  git push origin main
  ```
- [ ] **T1.10.4** Nettoyage post-merge
  ```bash
  git branch -d refactor/structure-cleanup
  git push origin --delete refactor/structure-cleanup
  ```

## **Plan de D√©ploiement**

### **√âtape 1 : Pr√©paration (1 jour)**
- [ ] Cr√©er une branche `refactor/structure-cleanup`
- [ ] Sauvegarder l'√©tat actuel
- [ ] Cr√©er un plan de rollback

### **√âtape 2 : Nettoyage (1 jour)**
- [ ] Supprimer le dossier `test-docs/`
- [ ] Identifier tous les imports √† mettre √† jour
- [ ] Cr√©er un script de migration

### **√âtape 3 : Restructuration (3 jours)**
- [ ] Migrer les API routes
- [ ] R√©organiser les composants
- [ ] Restructurer les types
- [ ] Ajouter les dossiers manquants

### **√âtape 4 : Tests et Validation (2 jours)**
- [ ] Mettre √† jour tous les imports
- [ ] Ex√©cuter la suite de tests compl√®te
- [ ] Valider le fonctionnement de l'application
- [ ] Tester les parcours utilisateurs critiques

### **√âtape 5 : Documentation (1 jour)**
- [ ] Mettre √† jour l'architecture.md
- [ ] Cr√©er le guide de conventions
- [ ] Documenter les changements

## **Risques et Mitigation**

### **Risque 1 : Casse de Build**
- **Mitigation** : Tests complets avant merge, rollback planifi√©
- **D√©tection** : CI/CD avec v√©rification automatique

### **Risque 2 : Imports Cass√©s**
- **Mitigation** : Script de migration automatis√©, recherche globale
- **D√©tection** : TypeScript compiler, ESLint

### **Risque 3 : R√©gression Fonctionnelle**
- **Mitigation** : Tests E2E complets, validation manuelle
- **D√©tection** : Playwright tests, parcours utilisateurs

## **M√©triques de Succ√®s**

### **M√©triques Techniques**
- [ ] **0 erreurs de build** apr√®s refactoring
- [ ] **100% des tests passent** (unitaires, int√©gration, E2E)
- [ ] **Temps de build inchang√©** ou am√©lior√©
- [ ] **Bundle size stable** ou r√©duit

### **M√©triques Qualit√©**
- [ ] **Score ESLint** maintenu ou am√©lior√©
- [ ] **Couverture de tests** maintenue
- [ ] **TypeScript strict mode** sans erreurs

### **M√©triques D√©veloppement**
- [ ] **Temps de localisation de code** r√©duit de 30%
- [ ] **Nouveaux d√©veloppeurs** peuvent naviguer efficacement en < 1h
- [ ] **Ajout de nouvelles fonctionnalit√©s** acc√©l√©r√© de 20%

## **D√©pendances**

### **D√©pendances Techniques**
- **Aucune** : Refactoring autonome, pas de nouvelles d√©pendances

### **D√©pendances √âquipe**
- **Validation PO** : Approbation de la structure finale
- **Review Dev** : Code review de tous les changements
- **Tests QA** : Validation des parcours utilisateurs

## **Notes et Consid√©rations**

### **Impact sur les Objectifs Produit**
Cette refactorisation contribue directement aux objectifs du PRD :
- **R√©duction du temps d'onboarding** : Structure claire pour nouveaux d√©veloppeurs
- **Am√©lioration de la v√©locit√©** : Code plus maintenable et √©volutif
- **Qualit√© du code** : Standards et conventions √©tablis

### **Alignement avec l'Architecture**
La nouvelle structure respecte les principes d√©finis dans `architecture.md` :
- **Monorepo** : Organisation claire dans `apps/web/`
- **Next.js 14** : Respect des conventions App Router
- **TypeScript** : Types bien organis√©s et typ√©s

### **√âvolutivit√© Future**
La structure propos√©e facilite :
- **Ajout de nouvelles fonctionnalit√©s** : Organisation claire par domaine
- **Int√©gration de nouveaux services** : API routes standardis√©es
- **√âquipes multiples** : S√©paration claire des responsabilit√©s

## **R√©sum√© des Accomplissements - Phases 1, 2 et 3**

### **Phase 1 : Nettoyage Imm√©diat - ‚úÖ TERMIN√âE**

#### **T1.1 Pr√©paration et Sauvegarde - ‚úÖ TERMIN√âE**
- [x] Branche `refactor/structure-cleanup` cr√©√©e et pouss√©e
- [x] Snapshot de l'√©tat actuel sauvegard√© (`structure-before.txt`)
- [x] Tag de sauvegarde cr√©√© (`backup-before-refactor-20250126`)
- [x] Script de migration des imports cr√©√© (`migrate-imports.sh`)

#### **T1.2 Nettoyage du Dossier test-docs - ‚úÖ TERMIN√âE**
- [x] Dossier `test-docs/` analys√© (vide)
- [x] Aucune r√©f√©rence trouv√©e dans le code
- [x] Dossier supprim√© avec succ√®s
- [x] Aucun test √† mettre √† jour

### **Phase 2 : Restructuration des Composants - ‚úÖ TERMIN√âE**

#### **T1.4 Restructuration des Composants - ‚úÖ TERMIN√âE**
- [x] Nouvelle structure de dossiers cr√©√©e :
  ```
  components/
  ‚îú‚îÄ‚îÄ layout/           # ThreePanelsLayout
  ‚îú‚îÄ‚îÄ ui/              # ErrorScreen, LoadingScreen
  ‚îÇ   ‚îî‚îÄ‚îÄ universal/   # UniversalChatPanel, UniversalContentPanel, UniversalTreePanel
  ‚îú‚îÄ‚îÄ documentation/   # RichTextEditor, DocumentationModals
  ‚îî‚îÄ‚îÄ workspace/       # ChatPanel, WorkspaceSelector, WorkspaceHeader
  ```
- [x] Tous les composants migr√©s vers leurs nouveaux emplacements
- [x] Nouveaux composants workspace cr√©√©s (WorkspaceSelector, WorkspaceHeader)
- [x] Fichiers d'index cr√©√©s pour faciliter les imports
- [x] Script de migration des imports ex√©cut√©
- [x] Imports corrig√©s manuellement pour ThreePanelsLayout

#### **Structure Finale des Composants**
```
apps/web/src/components/
‚îú‚îÄ‚îÄ index.ts                    # Export principal
‚îú‚îÄ‚îÄ layout/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts               # Export ThreePanelsLayout
‚îÇ   ‚îî‚îÄ‚îÄ ThreePanelsLayout.tsx
‚îú‚îÄ‚îÄ ui/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts               # Export ErrorScreen, LoadingScreen
‚îÇ   ‚îú‚îÄ‚îÄ ErrorScreen.tsx
‚îÇ   ‚îú‚îÄ‚îÄ LoadingScreen.tsx
‚îÇ   ‚îî‚îÄ‚îÄ universal/
‚îÇ       ‚îú‚îÄ‚îÄ index.ts           # Export composants universels
‚îÇ       ‚îú‚îÄ‚îÄ UniversalChatPanel.tsx
‚îÇ       ‚îú‚îÄ‚îÄ UniversalContentPanel.tsx
‚îÇ       ‚îî‚îÄ‚îÄ UniversalTreePanel.tsx
‚îú‚îÄ‚îÄ documentation/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts               # Export RichTextEditor, DocumentationModals
‚îÇ   ‚îú‚îÄ‚îÄ RichTextEditor.tsx
‚îÇ   ‚îî‚îÄ‚îÄ DocumentationModals.tsx
‚îî‚îÄ‚îÄ workspace/
    ‚îú‚îÄ‚îÄ index.ts               # Export ChatPanel, WorkspaceSelector, WorkspaceHeader
    ‚îú‚îÄ‚îÄ ChatPanel.tsx
    ‚îú‚îÄ‚îÄ WorkspaceSelector.tsx
    ‚îî‚îÄ‚îÄ WorkspaceHeader.tsx
```

### **Probl√®mes Rencontr√©s et R√©solus**
1. **Erreur d'import ThreePanelsLayout** : Corrig√© manuellement apr√®s migration automatique
2. **Exports TypeScript** : Corrig√© les exports pour utiliser `export { default as ... }` pour les composants avec `export default`
3. **Erreur RichTextEditor** : Probl√®me de version React non li√© √† la refactorisation
4. **Imports de types** : Corrig√© les chemins d'import dans les fichiers de types apr√®s migration
5. **H√©ritage TypeScript** : R√©solu les probl√®mes d'h√©ritage en red√©finissant explicitement les propri√©t√©s

### **Phase 3 : Restructuration des Types - ‚úÖ TERMIN√âE**

#### **T1.5 Restructuration des Types - ‚úÖ TERMIN√âE**
- [x] Nouvelle structure de types cr√©√©e :
  ```
  types/
  ‚îú‚îÄ‚îÄ api/             # Types pour les API
  ‚îÇ   ‚îú‚îÄ‚îÄ workspace.ts
  ‚îÇ   ‚îú‚îÄ‚îÄ documentation.ts
  ‚îÇ   ‚îú‚îÄ‚îÄ github.ts
  ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
  ‚îú‚îÄ‚îÄ components/      # Types pour les composants
  ‚îÇ   ‚îú‚îÄ‚îÄ universal.ts
  ‚îÇ   ‚îú‚îÄ‚îÄ ui.ts
  ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
  ‚îú‚îÄ‚îÄ auth.ts          # Types d'authentification
  ‚îú‚îÄ‚îÄ common.ts        # Types partag√©s
  ‚îî‚îÄ‚îÄ index.ts         # Export principal
  ```
- [x] Tous les types existants migr√©s vers la nouvelle structure
- [x] Nouveaux types cr√©√©s (GitHub, UI, Auth)
- [x] Fichiers d'index cr√©√©s pour faciliter les imports
- [x] Script de migration des imports ex√©cut√©
- [x] Imports corrig√©s manuellement pour les erreurs TypeScript

#### **Structure Finale des Types**
```
apps/web/src/types/
‚îú‚îÄ‚îÄ index.ts                    # Export principal
‚îú‚îÄ‚îÄ common.ts                   # Types partag√©s
‚îú‚îÄ‚îÄ auth.ts                     # Types d'authentification
‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îú‚îÄ‚îÄ index.ts               # Export API types
‚îÇ   ‚îú‚îÄ‚îÄ workspace.ts           # Types workspace
‚îÇ   ‚îú‚îÄ‚îÄ documentation.ts       # Types documentation
‚îÇ   ‚îî‚îÄ‚îÄ github.ts              # Types GitHub
‚îî‚îÄ‚îÄ components/
    ‚îú‚îÄ‚îÄ index.ts               # Export component types
    ‚îú‚îÄ‚îÄ universal.ts           # Types composants universels
    ‚îî‚îÄ‚îÄ ui.ts                  # Types composants UI
```

### **Phase 4 : Cr√©ation des Dossiers Constants et Utils - ‚úÖ TERMIN√âE**

#### **T1.6 Cr√©ation des Dossiers Constants et Utils - ‚úÖ TERMIN√âE**
- [x] Nouvelle structure de constants cr√©√©e :
  ```
  constants/
  ‚îú‚îÄ‚îÄ index.ts                 # Export principal
  ‚îú‚îÄ‚îÄ api.ts                   # Constantes API (endpoints, m√©thodes, codes)
  ‚îú‚îÄ‚îÄ routes.ts                # Constantes de routes
  ‚îî‚îÄ‚îÄ ui.ts                    # Constantes UI (breakpoints, couleurs, etc.)
  ```
- [x] Nouvelle structure de utils cr√©√©e :
  ```
  utils/
  ‚îú‚îÄ‚îÄ index.ts                 # Export principal
  ‚îú‚îÄ‚îÄ api.ts                   # Utilitaires API (client, gestion d'erreurs)
  ‚îú‚îÄ‚îÄ auth.ts                  # Utilitaires d'authentification
  ‚îî‚îÄ‚îÄ formatting.ts            # Utilitaires de formatage
  ```
- [x] Toutes les constantes impl√©ment√©es avec types TypeScript stricts
- [x] Utilitaires API avec gestion compl√®te des erreurs et timeouts
- [x] Utilitaires d'authentification avec gestion des tokens
- [x] Utilitaires de formatage pour dates, fichiers, nombres, etc.
- [x] Tests unitaires cr√©√©s pour valider le fonctionnement
- [x] Fichiers d'index cr√©√©s pour faciliter les imports

#### **Structure Finale des Constants et Utils**
```
apps/web/src/constants/
‚îú‚îÄ‚îÄ index.ts                    # Export principal
‚îú‚îÄ‚îÄ api.ts                      # API_ENDPOINTS, API_METHODS, API_STATUS_CODES, etc.
‚îú‚îÄ‚îÄ routes.ts                   # ROUTES, ROUTE_PARAMS, EXTERNAL_ROUTES
‚îî‚îÄ‚îÄ ui.ts                       # UI_BREAKPOINTS, UI_COLORS, UI_SPACING, etc.

apps/web/src/utils/
‚îú‚îÄ‚îÄ index.ts                    # Export principal
‚îú‚îÄ‚îÄ api.ts                      # apiClient, ApiError, isApiSuccess, etc.
‚îú‚îÄ‚îÄ auth.ts                     # isAuthenticated, getAuthToken, logout, etc.
‚îî‚îÄ‚îÄ formatting.ts               # formatFileSize, formatDate, truncateText, etc.
```

#### **Fonctionnalit√©s Impl√©ment√©es**
1. **Constants API** : Endpoints, m√©thodes HTTP, codes de statut, headers, types de contenu
2. **Constants Routes** : Routes de l'application, param√®tres, segments, routes externes
3. **Constants UI** : Breakpoints, couleurs, espacements, tailles de police, animations, z-index
4. **Utils API** : Client API avec gestion d'erreurs, timeouts, types TypeScript stricts
5. **Utils Auth** : Gestion des tokens, authentification, d√©connexion, rafra√Æchissement
6. **Utils Formatting** : Formatage de fichiers, dates, nombres, textes, chemins, dur√©es

### **Phase 5 : Mise √† Jour Compl√®te des Imports - ‚úÖ TERMIN√âE**

#### **T1.7 Mise √† Jour Compl√®te des Imports - ‚úÖ TERMIN√âE**
- [x] Script de migration automatis√© cr√©√© et ex√©cut√©
- [x] Tous les imports de composants migr√©s vers la nouvelle structure
- [x] Tous les imports de types migr√©s vers la nouvelle organisation
- [x] Migration des appels fetch vers le client API centralis√©
- [x] Ajout des utilitaires manquants pour les API routes
- [x] Validation de la compilation TypeScript r√©ussie
- [x] Tests de build r√©ussis

#### **Fichiers Migr√©s avec Succ√®s**
1. **`repos/page.tsx`** : Migration compl√®te vers apiClient et constants
2. **`context/page.tsx`** : Migration des appels API et gestion d'erreurs
3. **Routes API** : Ajout des utilitaires createErrorResponse et handleApiError
4. **Imports globaux** : Tous les imports mis √† jour vers la nouvelle structure

#### **Am√©liorations Apport√©es**
1. **Centralisation des appels API** : Utilisation du client API unifi√©
2. **Gestion d'erreurs standardis√©e** : Utilisation des utilitaires d'erreur
3. **Types TypeScript stricts** : Typage correct des r√©ponses API
4. **Constantes centralis√©es** : Utilisation des constantes API et routes
5. **Code plus maintenable** : R√©duction de la duplication de code

### **√âtat Actuel du Projet**
- ‚úÖ **Phase 1** : Nettoyage imm√©diat termin√©
- ‚úÖ **Phase 2** : Restructuration des composants termin√©e
- ‚úÖ **Phase 3** : Restructuration des types termin√©e
- ‚úÖ **Phase 4** : Cr√©ation des dossiers Constants et Utils (T1.6) - Termin√©e
- ‚úÖ **Phase 5** : Mise √† jour compl√®te des imports (T1.7) - Termin√©e
- üîÑ **Phase 6** : Tests et validation (T1.8) - √Ä faire

### **Instructions pour le Nouveau D√©veloppeur**
1. **Lire attentivement** cette story compl√®te pour comprendre le contexte
2. **V√©rifier l'√©tat actuel** en consultant les sections "R√©sum√© des Accomplissements"
3. **Commencer par la Phase 6** (T1.8) - Tests et validation
4. **Suivre exactement** les instructions d√©taill√©es dans chaque t√¢che
5. **Tester √† chaque phase** avant de passer √† la suivante
6. **Mettre √† jour** cette story avec les accomplissements

### **Fichiers de R√©f√©rence Importants**
- `migrate-imports.sh` : Script pour migrer les imports de composants
- `migrate-type-imports.sh` : Script pour migrer les imports de types
- `structure-before.txt` : Snapshot de la structure avant refactorisation

---

**Auteur :** Sarah (PO)  
**Date de cr√©ation :** 2025-01-26  
**Version :** 1.0  
**Statut :** Phases 1, 2 et 3 termin√©es - Pr√™t pour test
