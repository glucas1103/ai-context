# Story 1.8.1: Refactorisation de la structure de la codebase

## Status
Draft

## Story
**As a** développeur,
**I want** une structure de codebase cohérente et bien organisée,
**so that** le code soit maintenable, les tests reflètent la réalité, et les responsabilités soient clairement séparées

## Acceptance Criteria
1. **Élimination de la double structure d'endpoints API**
   - Supprimer la structure `WORKSPACES_STRUCTURED` et `GITHUB.REPO_DETAILS/CONTENT` non utilisée
   - Garder uniquement la structure réellement utilisée dans l'application
   - Mettre à jour les tests pour qu'ils testent uniquement ce qui est utilisé

2. **Unification de la gestion d'erreurs**
   - Consolider la logique de gestion d'erreurs dans `lib/errors.ts`
   - Supprimer la duplication entre `utils/api.ts` et `lib/errors.ts`
   - Standardiser les formats de réponse d'erreur

3. **Clarification des responsabilités par dossier**
   - `hooks/` : État React et effets de bord uniquement
   - `utils/` : Fonctions utilitaires pures sans état
   - `lib/` : Services, logique métier et intégrations externes
   - `constants/` : Configuration et valeurs statiques
   - `types/` : Définitions TypeScript

4. **Tests cohérents avec la réalité**
   - Les tests API testent uniquement les endpoints existants et utilisés
   - Les tests de composants testent la logique métier réelle
   - Supprimer les tests artificiels qui ne reflètent pas l'usage réel

5. **Documentation de la structure**
   - Créer un guide de style pour l'organisation du code
   - Documenter les conventions de nommage et d'organisation
   - Ajouter des commentaires explicatifs dans les fichiers clés

## Tasks / Subtasks
- [ ] **Audit complet de la structure actuelle** (AC: 1, 2, 3)
  - [ ] Identifier tous les fichiers avec des responsabilités mal placées
  - [ ] Lister les duplications de logique
  - [ ] Documenter l'usage réel vs testé des endpoints API

- [ ] **Nettoyage de la structure API** (AC: 1, 4)
  - [ ] Supprimer `WORKSPACES_STRUCTURED` de `constants/api.ts`
  - [ ] Supprimer `GITHUB.REPO_DETAILS` et `GITHUB.REPO_CONTENT`
  - [ ] Mettre à jour les tests pour qu'ils testent uniquement la structure utilisée
  - [ ] Vérifier qu'aucun code ne référence les endpoints supprimés

- [ ] **Unification de la gestion d'erreurs** (AC: 2)
  - [ ] Migrer toute la logique d'erreurs vers `lib/errors.ts`
  - [ ] Supprimer `createErrorResponse` et `handleApiError` de `utils/api.ts`
  - [ ] Mettre à jour tous les imports pour utiliser `lib/errors.ts`
  - [ ] Standardiser le format des réponses d'erreur

- [ ] **Réorganisation des responsabilités** (AC: 3)
  - [ ] Déplacer les fonctions avec état React vers `hooks/`
  - [ ] Déplacer les services et intégrations vers `lib/`
  - [ ] Garder uniquement les utilitaires purs dans `utils/`
  - [ ] Vérifier que `constants/` ne contient que des valeurs statiques

- [ ] **Mise à jour des tests** (AC: 4)
  - [ ] Supprimer les tests des endpoints non utilisés
  - [ ] Améliorer les tests de composants pour tester la logique réelle
  - [ ] S'assurer que la couverture de tests reflète l'usage réel

- [ ] **Documentation et guides** (AC: 5)
  - [ ] Créer un guide de style pour l'organisation du code
  - [ ] Documenter les conventions de nommage
  - [ ] Ajouter des commentaires explicatifs dans les fichiers clés

## Dev Notes

### Contexte technique
- **Problème principal** : Double structure d'endpoints API dans `constants/api.ts`
  - Structure ancienne (utilisée) : `WORKSPACES`, `GITHUB_REPOS`, `AUTH_CALLBACK`
  - Structure nouvelle (testée mais non utilisée) : `WORKSPACES_STRUCTURED`, `GITHUB.REPO_DETAILS/CONTENT`

- **Duplication de logique** :
  - `utils/api.ts` : `createErrorResponse`, `handleApiError`
  - `lib/errors.ts` : Logique similaire mais différente

- **Responsabilités mal placées** :
  - Logique d'authentification répartie entre `hooks/useAuth.ts` et `utils/auth.ts`
  - Services mélangés avec des utilitaires

### Structure cible
```
src/
├── hooks/          # État React et effets de bord
├── utils/          # Fonctions utilitaires pures
├── lib/            # Services et logique métier
├── constants/      # Configuration statique
├── types/          # Définitions TypeScript
└── components/     # Composants React
```

### Fichiers clés à modifier
- `constants/api.ts` : Supprimer la structure non utilisée
- `utils/api.ts` : Supprimer la gestion d'erreurs dupliquée
- `lib/errors.ts` : Consolider toute la gestion d'erreurs
- Tests : Mettre à jour pour refléter l'usage réel

### Testing Standards
- **Test file location** : `__tests__/` dans chaque dossier concerné
- **Test standards** : Tests unitaires avec Jest et React Testing Library
- **Testing frameworks** : Jest, React Testing Library, Playwright pour les e2e
- **Specific requirements** : 
  - Tests API : Tester uniquement les endpoints existants et utilisés
  - Tests composants : Tester la logique métier réelle, pas juste le rendu
  - Supprimer les tests artificiels qui ne reflètent pas l'usage

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-26 | 1.0 | Création initiale de la story | PO |

## Dev Agent Record

### Agent Model Used
Claude Sonnet 4

### Debug Log References
N/A

### Completion Notes List
N/A

### File List
N/A

## QA Results
N/A
